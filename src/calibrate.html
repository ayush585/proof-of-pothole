<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ProofOfPothole - Calibrate</title>
  <link rel="stylesheet" href="./styles.css"/>
  <style>
    .grid {
      display: grid;
      gap: 8px;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    }
    .card {
      border: 1px solid #1f2937;
      border-radius: 8px;
      padding: 8px;
      background: #0b1220;
    }
    .thumb {
      width: 100%;
      height: 110px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid #111827;
    }
    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .status-note {
      font-size: 0.85rem;
      color: #94a3b8;
    }
  </style>
  <script>
    window.loadCV = () =>
      new Promise((resolve) => {
        try {
          if (window.cv && window.cv.Mat) {
            resolve();
            return;
          }
          const script = document.createElement("script");
          script.src = "./opencv.min.js"; // file must live in /src/
          script.onload = () => {
            if (window.cv && typeof window.cv.onRuntimeInitialized === "function") {
              const original = window.cv.onRuntimeInitialized;
              window.cv.onRuntimeInitialized = () => {
                if (typeof original === "function") {
                  try {
                    original();
                  } catch (err) {
                    // ignore
                  }
                }
                resolve();
              };
            } else {
              resolve();
            }
          };
          script.onerror = () => resolve();
          document.head.appendChild(script);
        } catch (err) {
          resolve();
        }
      });
  </script>
</head>
<body>
  <header class="topbar">
    <h1>Calibration</h1>
    <a href="./index.html" style="color:#9ca3af">Back</a>
  </header>

  <main class="wrap">
    <section class="row">
      <label for="files" class="sr-only">Select image files</label>
      <input id="files" type="file" accept="image/*" multiple title="Select image files to calibrate" placeholder="Select image files" aria-label="Select image files"/>
      <button id="run" type="button">Run Calibration</button>
      <button id="dl" type="button">Download CSV</button>
      <span id="prog" style="margin-left:8px;color:#9ca3af"></span>
      <span id="gpsStatus" class="status-note" aria-live="polite"></span>
    </section>

    <section id="stats" class="row"></section>
    <section id="grid" class="grid"></section>
    <canvas id="work" class="hidden"></canvas>
  </main>

  <script type="module" src="./calibrate.browser.js"></script>
</body>
</html>
